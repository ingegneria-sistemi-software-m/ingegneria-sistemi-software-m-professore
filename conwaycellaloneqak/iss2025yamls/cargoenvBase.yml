##cargoenvBase.yml

services:

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.10     
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - xpack.security.transport.ssl.enabled=false
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
    ports:
      - "9200:9200"
    networks:
      - cargo-network
 
  logstash:
    image: docker.elastic.co/logstash/logstash:7.17.10   
    container_name: logstash
    volumes:
      - ../src/main/resources/logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    ports:
      - "5044:5044" 		# Porta TCP per l'input TCP o Beats.
    depends_on:
      - elasticsearch
    networks:
      - cargo-network
 
 
  kibana:
    image: docker.elastic.co/kibana/kibana:7.17.10   
    container_name: kibana
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - "5601:5601"
    depends_on:
      - elasticsearch 
    networks:
      - cargo-network

  mosquitto:
    image: eclipse-mosquitto:1.6.15
    container_name: mosquitto
    environment:
      - MQTT_ALLOW_ANONYMOUS=true   # Permette connessioni anonime
    ports:
      - 1883:1883
      - 9001:9001                   # Optional:Utilizzata per WebSocket MQTT
    networks:
      - cargo-network

  mongosrv:
    image: mongo:6.0.4
    container_name: mongosrv
    mem_limit: 512m
    ports:
      - "27017:27017"
    command: mongod
    networks:
      - cargo-network

  eureka:
    image: 'natbodocker/springcloud-eureka'                                     
    container_name: eurekaserver 
    ports:
      - "8761:8761"
    environment:
      - EUREKA_CLIENT_REGISTER_WITH_EUREKA=false       # Il server Eureka non si registra da solo
      - EUREKA_CLIENT_FETCH_REGISTRY=false             # Il server Eureka non recupera il registro
      - EUREKA_SERVER_ENABLE_SELF_PRESERVATION=false   # Disabilita la modalitÃ  di auto-conservazione per testare l'auto-rimozione delle istanze
      - EUREKA_INSTANCE_LEASE_RENEWAL_INTERVAL_IN_SECONDS=60
      - EUREKA_INSTANCE_LEASE_EXPIRATION_DURATION_IN_SECONDS=120
    networks:
      - cargo-network

networks:
  cargo-network:
    external: true

## yamls> docker network ls
## docker network create cargo-network
## docker-compose -f cargoenvbase.yml -p cargoenvbase up

 
